var win=Ti.UI.currentWindow;var isAndroid=false;if(Ti.Platform.name=='android'){isAndroid=true;}
var mountainView=Ti.Map.createAnnotation({latitude:37.390749,longitude:-122.081651,title:"Appcelerator Headquarters",subtitle:'Mountain View, CA',pincolor:isAndroid?"orange":Ti.Map.ANNOTATION_RED,animate:true,leftButton:'../images/appcelerator_small.png',myid:1});var apple=Ti.Map.createAnnotation({latitude:37.33168900,longitude:-122.03073100,title:"Steve Jobs",subtitle:'Cupertino, CA',pincolor:Ti.Map.ANNOTATION_GREEN,animate:true,rightButton:'../images/apple_logo.jpg',myid:2});var atlantaParams={latitude:33.74511,longitude:-84.38993,title:"Atlanta, GA",subtitle:'Atlanta Braves Stadium\nfoo',animate:true,leftButton:'../images/atlanta.jpg',rightButton:Ti.UI.iPhone.SystemButton.DISCLOSURE,myid:3};if(!isAndroid){atlantaParams.pincolor=Ti.Map.ANNOTATION_PURPLE;}else{atlantaParams.pinImage="../images/map-pin.png";}
var atlanta=Ti.Map.createAnnotation(atlantaParams);var regionAtlanta={latitude:33.74511,longitude:-84.38993,animate:true,latitudeDelta:0.04,longitudeDelta:0.04};var regionSV={latitude:37.337681,longitude:-122.038193,animate:true,latitudeDelta:0.04,longitudeDelta:0.04};var presetAnnotations=[atlanta,apple];var mapview=Ti.Map.createView({mapType:Ti.Map.STANDARD_TYPE,region:{latitude:33.74511,longitude:-84.38993,latitudeDelta:0.5,longitudeDelta:0.5},animate:true,regionFit:true,userLocation:true,annotations:presetAnnotations});if(!isAndroid){mapview.addAnnotation(atlanta);}
mapview.selectAnnotation(atlanta);win.add(mapview);var removeAll=null;var atl=null;var sv=null;var sat=null;var std=null;var hyb=null;var zoomin=null;var zoomout=null;var wireClickHandlers=function(){removeAll.addEventListener('click',function(){mapview.removeAllAnnotations();});atl.addEventListener('click',function(){mapview.setLocation(regionAtlanta);mapview.selectAnnotation(presetAnnotations[0].title,true);Ti.API.error("CLICKED ATL");});sv.addEventListener('click',function(){Ti.API.info('IN SV CHANGE');mapview.setLocation(regionSV);mapview.selectAnnotation(presetAnnotations[1].title,true);});sat.addEventListener('click',function(){mapview.setMapType(Ti.Map.SATELLITE_TYPE);});std.addEventListener('click',function(){mapview.setMapType(Ti.Map.STANDARD_TYPE);});hyb.addEventListener('click',function(){mapview.setMapType(Ti.Map.HYBRID_TYPE);});zoomin.addEventListener('click',function(){mapview.zoom(1);});zoomout.addEventListener('click',function(){mapview.zoom(-1);});};if(!isAndroid){removeAll=Ti.UI.createButton({style:Ti.UI.iPhone.SystemButtonStyle.BORDERED,title:'Remove All'});win.rightNavButton=removeAll;atl=Ti.UI.createButton({style:Ti.UI.iPhone.SystemButtonStyle.BORDERED,title:'ATL'});sv=Ti.UI.createButton({style:Ti.UI.iPhone.SystemButtonStyle.BORDERED,title:'SV'});mapview.addEventListener('complete',function()
{Ti.API.info("map has completed loaded region");});var flexSpace=Ti.UI.createButton({systemButton:Ti.UI.iPhone.SystemButton.FLEXIBLE_SPACE});sat=Ti.UI.createButton({title:'Sat',style:Ti.UI.iPhone.SystemButtonStyle.BORDERED});std=Ti.UI.createButton({title:'Std',style:Ti.UI.iPhone.SystemButtonStyle.BORDERED});hyb=Ti.UI.createButton({title:'Hyb',style:Ti.UI.iPhone.SystemButtonStyle.BORDERED});zoomin=Ti.UI.createButton({title:'+',style:Ti.UI.iPhone.SystemButtonStyle.BORDERED});zoomout=Ti.UI.createButton({title:'-',style:Ti.UI.iPhone.SystemButtonStyle.BORDERED});wireClickHandlers();win.setToolbar([flexSpace,std,flexSpace,hyb,flexSpace,sat,flexSpace,atl,flexSpace,sv,flexSpace,zoomin,flexSpace,zoomout,flexSpace]);}else{var activity=Ti.Android.currentActivity;activity.onCreateOptionsMenu=function(e){var menu=e.menu;atl=menu.add({title:'ATL'});sv=menu.add({title:'SV'});sat=menu.add({title:'Sat'});std=menu.add({title:'Std'});hyb=menu.add({title:'Hyb'});zoomin=menu.add({title:"Zoom In"});zoomout=menu.add({title:'Zoom Out'});removeAll=menu.add({title:'Remove All'});wireClickHandlers();};}
mapview.addEventListener('regionChanged',function(evt)
{Ti.API.info('maps region has updated to '+evt.longitude+','+evt.latitude+','+evt.latitudeDelta+','+evt.longitudeDelta);Ti.API.info(mapview.latitudeDelta+','+mapview.longitudeDelta);if(evt.latitudeDelta===mapview.latitudeDelta)
{Ti.API.info('latitudeDelta property matches event values');}
if(evt.longitudeDelta===mapview.longitudeDelta)
{Ti.API.info('longitudeDelta property matches event values');}});var annotationAdded=false;mapview.addEventListener('click',function(evt)
{var annotation=evt.annotation;var title=evt.title;var clickSource=evt.clicksource;var myid=(evt.annotation)?evt.annotation.myid:-1;Ti.API.info('mapview click clicksource = '+clickSource);if(myid==3&&evt.clicksource=='rightButton')
{evt.annotation.rightView=Ti.UI.createView({width:20,height:20,backgroundColor:'red'});evt.annotation.leftView=Ti.UI.createView({width:20,height:20,backgroundColor:'#336699'});evt.annotation.title="Atlanta?";evt.annotation.pincolor=Ti.Map.ANNOTATION_GREEN;evt.annotation.subtitle='Appcelerator used to be near here';evt.annotation.leftButton='images/appcelerator_small.png';}
if(myid==2)
{if(annotationAdded===false)
{mapview.addAnnotation(mountainView);annotationAdded=true;}
else
{mapview.removeAnnotation(mountainView);annotationAdded=false;}}});atlanta.addEventListener('click',function(evt)
{var annotation=evt.source;var clicksource=evt.clicksource;Ti.API.info('atlanta annotation click clicksource = '+clicksource);});apple.addEventListener('click',function(evt)
{var annotation=evt.source;var clicksource=evt.clicksource;Ti.API.info('apple annotation click clicksource = '+clicksource);});